<link href="https://fonts.googleapis.com/css?family=Inconsolata&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Roboto:300&display=swap" rel="stylesheet">
<link href="css/style.css" rel="stylesheet">

<br><br><br>
<center><h1 style="font-family:'Roboto'; font-size:500%"></h1></center>

<body id="mainbody">

	<div id="buttonwrapper">
		<button onclick="topen(100)">top 100</button>
		<button onclick="topen(1000)">top 1000</button>
		<button onclick="newPrompt()">excerpt</button>
	</div>

	<br>

	<div id="promptwrapper">
		<div id="prompt" style="padding:15px; padding-left: 20px; padding-right: 20px"><span>The </span><span>quick </span><span>brown </span><span>fox </span><span>jumps </span><span>over </span><span>the </span><span>lazy </span><span>dog. </span></div>
	</div>

	<div id="wpmwrapper">
		<span id="wpm" style="float:left">0</span>&nbspWPM
	</div>

	<br><br>

	<div style="text-align:center">
		<div><input type="text" id="typeinput"></div>
	</div>

</body>

<script src="js/prompts.js"></script>
<script src="js/topPrompts.js"></script>

<script>

var root = document.documentElement;

var startTime = 0;

var promptArr = ['The', 'quick', 'brown', 'fox', 'jumps', 'over', 'the', 'lazy', 'dog.'];
var promptDiv = document.getElementById('prompt');
var wpmSpan = document.getElementById('wpm');

var completed = "";

var input = document.getElementById('typeinput');
var curr = 0;
var done = false;
var first = true;

// listens to keystrokes in input box
input.addEventListener('input', function() {

	// set starting time to measure wpm
	if (curr === 0 && first){
		startTime = Date.now();
		first = false;
	}

    // Get cursor position
    var start = this.selectionStart;

    // Get last typed character
    var lastChar = String.fromCharCode(this.value.charCodeAt(start - 1));

    // clears input box if correct word is typed
    if((lastChar === ' ' && this.value == promptArr[curr]+" ") || (curr === promptArr.length-1 && this.value === promptArr[curr])) {
        // append to completed string
        completed += this.value;

        // update prompt word color indicators
		promptDiv.childNodes[curr].style.color = getComputedStyle(root).getPropertyValue("--completed-word");
		if (curr != promptArr.length-1){
			promptDiv.childNodes[curr+1].style.color = getComputedStyle(root).getPropertyValue("--current-word");
		}

		// calculate and display wpm
    	wpmSpan.innerHTML = ((completed.length/5)/((Date.now()-startTime)/60000)).toFixed(2);
        
        // clear the board and increment promptArr index
        this.value = "";
        curr++;
    }

    // set background of input box to red if incorrect character is typed
    if (this.value.length > 0 && this.value !== promptArr[curr].substring(0, this.value.length)){
    	this.style.background = getComputedStyle(root).getPropertyValue("--wrong-word");
    } else {
    	this.style.background = getComputedStyle(root).getPropertyValue("--base-2");
    }

    // end prompt if last word is typed (space not necessary)
    if (curr === promptArr.length && !done){
		promptDiv.innerHTML += "✔️";
		done = true;
    }

});

// sets new prompt, taken from prompts list, and resets variables
function newPrompt() {
	var rand = Math.floor(Math.random() * prompts.length);
	promptArr = prompts[rand].split(' ');
	promptDiv.innerHTML = "";
	for (var i=0; i<promptArr.length; i++){
		promptDiv.innerHTML += "<span>" + promptArr[i] + " </span>";
	}
	curr = 0;
	first = true;
	done = false;
	promptDiv.parentElement.style.background = getComputedStyle(root).getPropertyValue("--base-2");
	promptDiv.childNodes[0].style.color = getComputedStyle(root).getPropertyValue("--current-word");
	completed = "";
}

// sets new prompt, taken from top n words in english variable
function topen(n) {
	var bank = eval("top" + n.toString());

	promptDiv.innerHTML = "";
	promptArr = [];
	for (i=0;i<49;i++){
		promptArr.push(bank[Math.floor(Math.random() * bank.length)]);
	}
	promptArr.push(bank[Math.floor(Math.random() * bank.length)]);

	for (var i=0; i<promptArr.length; i++){
		promptDiv.innerHTML += "<span>" + promptArr[i] + " </span>";
	}
	curr = 0;
	first = true;
	done = false;
    promptDiv.parentElement.style.background = getComputedStyle(root).getPropertyValue("--base-2");
	promptDiv.childNodes[0].style.color = getComputedStyle(root).getPropertyValue("--current-word");
	completed = "";
}

</script>

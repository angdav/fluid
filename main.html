<link href="https://fonts.googleapis.com/css?family=Inconsolata&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Roboto:300&display=swap" rel="stylesheet">
<link href="css/style.css" rel="stylesheet">
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">


<br><br><br>
<center><h1 style="font-family:'Roboto'; font-size:500%"></h1></center>

<body style="background:#333">
	<div id="wpmwrapper">
		<span id="wpm" style="float:left">0</span>&nbspWPM
	</div>

	<div id="promptwrapper">
		<div id="prompt" style="float:left">The quick brown fox jumped over the lazy dog.</div>
	</div>

	<br>

	<div id="buttonwrapper">
		<button class="btn btn-secondary" onclick="top(100)">top 100</button>
		<button class="btn btn-secondary" onclick="top(1000)">top 1000</button>
	</div>

	<br><br><br><br>

	<div style="text-align:center">
		<input type="text" id="typeinput">
	</div>

	<br><br><br>

	<div style="text-align:center">
		<button class="btn btn-secondary" onclick="newPrompt()">Refresh</button>
	</div>


</body>

<script src="js/prompts.js"></script>
<script src="js/topPrompts.js"></script>

<script>

var startTime = 0;

var promptArr = document.getElementById('prompt').innerHTML.split(" ");
var promptDiv = document.getElementById('prompt');
var wpmSpan = document.getElementById('wpm');

var completed = "";

var input = document.getElementById('typeinput');
var curr = 0;
var first = true;

// listens to keystrokes in input box
input.addEventListener('input', function() {

	// set starting time to measure wpm
	if (curr === 0 && first){
		startTime = Date.now();
		first = false;
	}

    // Get cursor position
    var start = this.selectionStart;

    // Get last typed character
    var lastChar = String.fromCharCode(this.value.charCodeAt(start - 1));

    // clears input box if correct word is typed
    if((lastChar === ' ' && this.value === promptArr[curr]+" ") || (curr === promptArr.length-1 && this.value === promptArr[curr])) {
        // append to completed string
        completed += this.value;

        // update prompt
    	promptDiv.innerHTML = promptDiv.innerHTML.substring(promptArr[curr].length+1);

		// calculate and display wpm
    	wpmSpan.innerHTML = ((completed.length/5)/((Date.now()-startTime)/60000)).toFixed(2);
        
        // clear the board and increment promptArr index
        this.value = "";
        curr++;
    }

    // set background of input box to red if incorrect character is typed
    if (this.value.length > 0 && this.value !== promptArr[curr].substring(0, this.value.length)){
    	this.style.background = "#d77";
    } else {
    	this.style.background = "#fff";
    }

    // end prompt if last word is typed (space not necessary)
    if (curr === promptArr.length){
    	document.getElementById('promptwrapper').style.background = "#7d7";
    	promptDiv.innerHTML = "you're done!";
    }

});

// sets new prompt, taken from prompts list, and resets variables
function newPrompt() {
	var rand = Math.floor(Math.random() * prompts.length);
	promptDiv.innerHTML = prompts[rand];
	curr = 0;
	first = true;
	promptArr = document.getElementById('prompt').innerHTML.split(" ");
    document.getElementById('promptwrapper').style.background = "#fff";
	completed = "";
}

// sets new prompt, taken from top n words in english varible
function top(n) {
	var bank = eval("top" + n.toString());

	var finPrompt = "";
	for (i=0;i<n;i++){
		finPrompt+= bank[Math.floor(Math.random() * bank.length)];
	}
	promptDiv.innerHTML = finPrompt;
	curr = 0;
	first = true;
	promptArr = promptDiv.innerHTML.split(" ");
    document.getElementById('promptwrapper').style.background = "#fff";
	completed = "";
}

</script>